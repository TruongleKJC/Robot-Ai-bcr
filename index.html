<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROBOT AI v21 - GHOST VISION</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2fe; --pink: #ff416c; --bg: rgba(10, 12, 16, 0.95); }
        body { background: transparent; color: #fff; font-family: sans-serif; margin: 0; padding: 5px; overflow: hidden; }
        
        /* Giao diện thu nhỏ để chạy Overlay */
        .overlay-app { 
            width: 280px; 
            background: var(--bg); 
            border: 1.5px solid var(--neon); 
            border-radius: 15px; 
            padding: 10px;
            box-shadow: 0 0 20px rgba(0, 242, 254, 0.5);
        }

        .scan-window {
            height: 100px;
            background: #000;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px dashed var(--neon);
            position: relative;
        }

        #video-preview { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; display: none; }
        .focus-bracket { position: absolute; width: 40px; height: 40px; border: 2px solid var(--neon); }
        .top-left { top: 10px; left: 10px; border-right: 0; border-bottom: 0; }
        .bot-right { bottom: 10px; right: 10px; border-left: 0; border-top: 0; }

        .res-box { text-align: center; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; }
        #ai-status { font-family: 'Orbitron'; font-size: 20px; color: var(--neon); margin: 5px 0; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-top: 10px; }
        .btn { border: none; padding: 10px 0; border-radius: 5px; color: #fff; font-weight: bold; cursor: pointer; font-size: 10px; }
        .b-ocr { background: #fcc21b; color: #000; grid-column: span 3; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="overlay-app">
    <div style="font-size: 9px; color: var(--neon); margin-bottom: 5px; font-weight: bold;">ROBOT v21 - OCR VISION ACTIVE</div>
    
    <div class="scan-window" id="capture-zone">
        <div class="focus-bracket top-left"></div>
        <div class="focus-bracket bot-right"></div>
        <video id="video-preview" autoplay playsinline></video>
        <div id="ocr-loading" style="font-size: 10px; color: #555;">CHỜ CAMERA...</div>
    </div>

    <div class="res-box">
        <div id="ai-status">WAITING</div>
        <div id="card-detected" style="font-size: 10px; color: #fcc21b;">LÁ BÀI: --</div>
    </div>

    <button class="btn b-ocr" onclick="startCamera()">BẬT QUÉT LÁ BÀI (CAMERA)</button>

    <div class="btn-group">
        <button class="btn" style="background:#4776e6" onclick="process('P')">PLAYER</button>
        <button class="btn" style="background:#00ff87; color:#000" onclick="process('T')">TIE</button>
        <button class="btn" style="background:#ff416c" onclick="process('B')">BANKER</button>
    </div>
</div>

<script>
    async function startCamera() {
        const video = document.getElementById('video-preview');
        const loading = document.getElementById('ocr-loading');
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            video.srcObject = stream;
            video.style.display = 'block';
            loading.style.display = 'none';
            // Bắt đầu chu kỳ quét OCR mỗi 3 giây
            setInterval(scanCards, 3000);
        } catch (err) {
            alert("Không thể mở camera. Hãy cấp quyền trong cài đặt.");
        }
    }

    async function scanCards() {
        const video = document.getElementById('video-preview');
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        // Sử dụng Tesseract AI để đọc số/chữ trên lá bài
        Tesseract.recognize(canvas, 'eng').then(({ data: { text } }) => {
            const cleanText = text.replace(/[^0-9AJQK]/g, "").slice(0, 2);
            if(cleanText) {
                document.getElementById('card-detected').innerText = "LÁ BÀI: " + cleanText;
                process(cleanText);
            }
        });
    }

    function process(val) {
        const status = document.getElementById('ai-status');
        status.innerText = "SCANNING...";
        setTimeout(() => {
            const res = Math.random() > 0.5 ? "BANKER" : "PLAYER";
            status.innerText = res;
            status.style.color = res === "BANKER" ? "#ff416c" : "#00f2fe";
        }, 1000);
    }
</script>
</body>
</html>
